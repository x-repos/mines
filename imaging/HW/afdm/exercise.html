
     <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
     <html>
     <head>
     <title>exercise/SConstruct</title>
     <style type="text/css">
     div.progs {
     background-color: #DCE3C4;
     border: thin solid black;
     padding: 1em;
     margin-left: 2em;
     margin-right: 2em; }
     div.dsets {
     background-color: #E3C4DC;
     border: thin solid black;
     padding: 1em;
     margin-left: 2em;
     margin-right: 2em; }
     div.scons {
     background-color: #FFF8ED;
     border: thin solid black;
     padding: 1em;
     margin-left: 2em;
     margin-right: 2em; }
     .number { color: #0080C0; }
.op { color: #0000C0; }
.string { color: #004080; }
.comment { color: #008000; }
.name { color: #000000; }
.error { color: #FF8080; }
.keyword { color: #C00000; }
.text { color: #000000; }
.fetch { color: #0000C0; }
.flow { color: #0000C0; }
.plot { color: #0000C0; }
.result { color: #C00000; }
</style>
     </head>
     <body>
     <div>
     <a href="paper_html/paper.html"><img width="32" height="32"
     align="bottom" border="0" alt="up" src="paper_html/icons/up.png"></a>
     <a href="paper.pdf"><img src="paper_html/icons/pdf.png" alt="[pdf]"
     width="32" height="32" border="0"></a>
     </div>
     <div class="scons">
     <table><tr><td>
     <pre><font face="Lucida,Courier New"><span class="comment">##</span>
<span class="comment"># GPGN658 - acoustic FD modeling</span>
<span class="comment">##</span>
<span class="keyword">from</span> <span class="name">rsf</span><span class="op">.</span><span class="name">proj</span> <span class="keyword">import</span> <span class="op">*</span>
<span class="keyword">import</span> <span class="name">awe</span><span class="op">,</span><span class="name">geom</span><span class="op">,</span><span class="name">wplot</span><span class="op">,</span><span class="name">pcsutil</span>

<span class="comment"># ------------------------------------------------------------</span>
<span class="name">par</span> <span class="op">=</span> <span class="name">dict</span><span class="op">(</span>
    <span class="name">nx</span><span class="op">=</span><span class="number">600</span><span class="op">,</span>  <span class="name">ox</span><span class="op">=</span><span class="number">0</span><span class="op">,</span> <span class="name">dx</span><span class="op">=</span><span class="number">0.002</span><span class="op">,</span>  <span class="name">lx</span><span class="op">=</span><span class="string">&#x27;x&#x27;</span><span class="op">,</span> <span class="name">ux</span><span class="op">=</span><span class="string">&#x27;km&#x27;</span><span class="op">,</span>
    <span class="name">ny</span><span class="op">=</span><span class="number">1</span><span class="op">,</span>    <span class="name">oy</span><span class="op">=</span><span class="number">0</span><span class="op">,</span> <span class="name">dy</span><span class="op">=</span><span class="number">0.002</span><span class="op">,</span>  <span class="name">ly</span><span class="op">=</span><span class="string">&#x27;y&#x27;</span><span class="op">,</span> <span class="name">uy</span><span class="op">=</span><span class="string">&#x27;km&#x27;</span><span class="op">,</span>
    <span class="name">nz</span><span class="op">=</span><span class="number">350</span><span class="op">,</span>  <span class="name">oz</span><span class="op">=</span><span class="number">0</span><span class="op">,</span> <span class="name">dz</span><span class="op">=</span><span class="number">0.002</span><span class="op">,</span>  <span class="name">lz</span><span class="op">=</span><span class="string">&#x27;z&#x27;</span><span class="op">,</span> <span class="name">uz</span><span class="op">=</span><span class="string">&#x27;km&#x27;</span><span class="op">,</span>
    <span class="name">nt</span><span class="op">=</span><span class="number">4001</span><span class="op">,</span> <span class="name">ot</span><span class="op">=</span><span class="number">0</span><span class="op">,</span> <span class="name">dt</span><span class="op">=</span><span class="number">0.0002</span><span class="op">,</span> <span class="name">lt</span><span class="op">=</span><span class="string">&#x27;t&#x27;</span><span class="op">,</span> <span class="name">ut</span><span class="op">=</span><span class="string">&#x27;s&#x27;</span><span class="op">,</span>
    <span class="name">kt</span><span class="op">=</span><span class="number">150</span><span class="op">,</span><span class="name">nb</span><span class="op">=</span><span class="number">250</span><span class="op">,</span><span class="name">jsnap</span><span class="op">=</span><span class="number">100</span><span class="op">,</span><span class="name">frq</span><span class="op">=</span><span class="number">30</span>
    <span class="op">)</span>
<span class="name">awe</span><span class="op">.</span><span class="name">param</span><span class="op">(</span><span class="name">par</span><span class="op">)</span>
<span class="name">wplot</span><span class="op">.</span><span class="name">param</span><span class="op">(</span><span class="name">par</span><span class="op">)</span>

<span class="comment"># ------------------------------------------------------------</span>
<span class="comment"># acoustic source</span>
<span class="name">awe</span><span class="op">.</span><span class="name">wavelet</span><span class="op">(</span><span class="string">&#x27;wav&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;frq&#x27;</span><span class="op">]</span><span class="op">,</span><span class="string">&#x27;&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">)</span>
<span class="result">Result</span><span class="op">(</span><span class="string">&#x27;wav&#x27;</span><span class="op">,</span><span class="string">&#x27;transp |&#x27;</span> <span class="op">+</span> <span class="name">wplot</span><span class="op">.</span><span class="name">waveplot</span><span class="op">(</span><span class="string">&#x27;&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">)</span><span class="op">)</span>

<span class="comment"># ------------------------------------------------------------</span>
<span class="comment"># source coordinates</span>
<span class="name">par</span><span class="op">[</span><span class="string">&#x27;xsou&#x27;</span><span class="op">]</span><span class="op">=</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;ox&#x27;</span><span class="op">]</span><span class="op">+</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;nx&#x27;</span><span class="op">]</span><span class="op">/</span><span class="number">2</span><span class="op">*</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;dx&#x27;</span><span class="op">]</span>
<span class="name">par</span><span class="op">[</span><span class="string">&#x27;zsou&#x27;</span><span class="op">]</span><span class="op">=</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;oz&#x27;</span><span class="op">]</span><span class="op">+</span><span class="number">10</span><span class="op">*</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;dz&#x27;</span><span class="op">]</span>
<span class="name">geom</span><span class="op">.</span><span class="name">point2d</span><span class="op">(</span><span class="string">&#x27;ss&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;xsou&#x27;</span><span class="op">]</span><span class="op">,</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;zsou&#x27;</span><span class="op">]</span><span class="op">,</span><span class="string">&#x27;&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">)</span>

<span class="comment"># receiver coordinates</span>
<span class="name">par</span><span class="op">[</span><span class="string">&#x27;zrec&#x27;</span><span class="op">]</span><span class="op">=</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;oz&#x27;</span><span class="op">]</span><span class="op">+</span><span class="number">10</span><span class="op">*</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;dz&#x27;</span><span class="op">]</span>
<span class="name">geom</span><span class="op">.</span><span class="name">horizontal2d</span><span class="op">(</span><span class="string">&#x27;rr&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;zrec&#x27;</span><span class="op">]</span><span class="op">,</span><span class="string">&#x27;&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">)</span>

<span class="comment"># plots</span>
<span class="plot">Plot</span><span class="op">(</span><span class="string">&#x27;ss&#x27;</span><span class="op">,</span><span class="name">wplot</span><span class="op">.</span><span class="name">ssplot2d</span><span class="op">(</span><span class="string">&#x27;&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">)</span><span class="op">)</span>
<span class="plot">Plot</span><span class="op">(</span><span class="string">&#x27;rr&#x27;</span><span class="op">,</span><span class="name">wplot</span><span class="op">.</span><span class="name">rrplot2d</span><span class="op">(</span><span class="string">&#x27;&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">)</span><span class="op">)</span>

<span class="comment"># ------------------------------------------------------------</span>
<span class="name">pcsutil</span><span class="op">.</span><span class="name">angline</span><span class="op">(</span><span class="string">&#x27;dip&#x27;</span><span class="op">,</span>
                <span class="number">0.1</span><span class="op">,</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;ox&#x27;</span><span class="op">]</span><span class="op">,</span>
                <span class="op">+</span><span class="number">45</span><span class="op">,</span>
                <span class="number">0</span><span class="op">,</span><span class="number">1</span><span class="op">,</span>
                <span class="name">par</span><span class="op">[</span><span class="string">&#x27;nz&#x27;</span><span class="op">]</span>  <span class="op">,</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;oz&#x27;</span><span class="op">]</span><span class="op">,</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;dz&#x27;</span><span class="op">]</span><span class="op">,</span>
                <span class="name">par</span><span class="op">[</span><span class="string">&#x27;nx&#x27;</span><span class="op">]</span><span class="op">/</span><span class="number">2</span><span class="op">,</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;ox&#x27;</span><span class="op">]</span><span class="op">,</span><span class="name">par</span><span class="op">[</span><span class="string">&#x27;dx&#x27;</span><span class="op">]</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">&#x27;con&#x27;</span><span class="op">,</span><span class="string">&#x27;dip&#x27;</span><span class="op">,</span><span class="string">&#x27;math output=0&#x27;</span><span class="op">)</span>

<span class="comment"># ------------------------------------------------------------</span>
<span class="comment"># Density (kg/km^3)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">&#x27;ro&#x27;</span><span class="op">,</span><span class="op">[</span><span class="string">&#x27;dip&#x27;</span><span class="op">,</span><span class="string">&#x27;con&#x27;</span><span class="op">]</span><span class="op">,</span>
     <span class="string">&#x27;cat axis=2 space=n ${SOURCES[1]} | add add=1 | reverse which=2 opt=i&#x27;</span><span class="op">%</span><span class="name">par</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">&#x27;roCON&#x27;</span><span class="op">,</span><span class="string">&#x27;ro&#x27;</span><span class="op">,</span><span class="string">&#x27;math output=1&#x27;</span><span class="op">)</span>

<span class="comment"># P velocity (km/s)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">&#x27;vp&#x27;</span><span class="op">,</span><span class="op">[</span><span class="string">&#x27;dip&#x27;</span><span class="op">,</span><span class="string">&#x27;con&#x27;</span><span class="op">]</span><span class="op">,</span>
     <span class="string">&#x27;cat axis=2 space=n ${SOURCES[1]} | add add=2&#x27;</span><span class="op">%</span><span class="name">par</span><span class="op">)</span>
<span class="flow">Flow</span><span class="op">(</span><span class="string">&#x27;vpCON&#x27;</span><span class="op">,</span><span class="string">&#x27;vp&#x27;</span><span class="op">,</span><span class="string">&#x27;math output=2&#x27;</span><span class="op">)</span>

<span class="comment"># plots</span>
<span class="keyword">for</span> <span class="name">i</span> <span class="keyword">in</span> <span class="op">(</span><span class="op">[</span><span class="string">&#x27;vp&#x27;</span><span class="op">,</span><span class="string">&#x27;ro&#x27;</span><span class="op">]</span><span class="op">)</span><span class="op">:</span>
    <span class="plot">Plot</span><span class="op">(</span><span class="name">i</span><span class="op">,</span><span class="name">wplot</span><span class="op">.</span><span class="name">igrey2d</span><span class="op">(</span><span class="string">&#x27;mean=y&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">)</span><span class="op">)</span>
    <span class="result">Result</span><span class="op">(</span><span class="name">i</span><span class="op">,</span><span class="op">[</span><span class="name">i</span><span class="op">,</span><span class="string">&#x27;rr&#x27;</span><span class="op">,</span><span class="string">&#x27;ss&#x27;</span><span class="op">]</span><span class="op">,</span><span class="string">&#x27;Overlay&#x27;</span><span class="op">)</span>

<span class="comment"># ------------------------------------------------------------</span>
<span class="comment"># acoustic FDM</span>
<span class="keyword">def</span> <span class="name">afdm</span><span class="op">(</span><span class="name">dat</span><span class="op">,</span><span class="name">wfl</span><span class="op">,</span><span class="name">wav</span><span class="op">,</span><span class="name">vel</span><span class="op">,</span><span class="name">den</span><span class="op">,</span><span class="name">sou</span><span class="op">,</span><span class="name">rec</span><span class="op">,</span><span class="name">custom</span><span class="op">,</span><span class="name">par</span><span class="op">)</span><span class="op">:</span>
    <span class="flow">Flow</span><span class="op">(</span><span class="op">[</span><span class="name">dat</span><span class="op">,</span><span class="name">wfl</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="name">wav</span><span class="op">,</span><span class="name">vel</span><span class="op">,</span><span class="name">den</span><span class="op">,</span><span class="name">sou</span><span class="op">,</span><span class="name">rec</span><span class="op">]</span><span class="op">,</span>
         <span class="string">&#x27;&#x27;&#x27;
         ./CODE/sfAFDM
         verb=y dabc=y snap=y jsnap=%(jsnap)d nb=%(nb)d
         vel=${SOURCES[1]}
         den=${SOURCES[2]}
         sou=${SOURCES[3]}
         rec=${SOURCES[4]}
         wfl=${TARGETS[1]}
         &#x27;&#x27;&#x27;</span><span class="op">%</span><span class="name">par</span> <span class="op">+</span> <span class="name">custom</span><span class="op">)</span>

<span class="name">afdm</span><span class="op">(</span>  <span class="string">&#x27;dat&#x27;</span><span class="op">,</span><span class="string">&#x27;wfl&#x27;</span><span class="op">,</span><span class="string">&#x27;wav&#x27;</span><span class="op">,</span><span class="string">&#x27;vp&#x27;</span><span class="op">,</span><span class="string">&#x27;ro&#x27;</span><span class="op">,</span><span class="string">&#x27;ss&#x27;</span><span class="op">,</span><span class="string">&#x27;rr&#x27;</span><span class="op">,</span><span class="string">&#x27;&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">)</span>
<span class="result">Result</span><span class="op">(</span><span class="string">&#x27;dat&#x27;</span><span class="op">,</span><span class="string">&#x27;transp |&#x27;</span><span class="op">+</span> <span class="name">wplot</span><span class="op">.</span><span class="name">dgrey2d</span><span class="op">(</span><span class="string">&#x27;pclip=99&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">)</span><span class="op">)</span>

<span class="result">Result</span><span class="op">(</span><span class="string">&#x27;wfl&#x27;</span><span class="op">,</span><span class="string">&#x27;window n3=1 f3=28|&#x27;</span> <span class="op">+</span> <span class="name">wplot</span><span class="op">.</span><span class="name">igrey2d</span><span class="op">(</span><span class="string">&#x27;pclip=99.9&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">)</span><span class="op">)</span>
<span class="result">Result</span><span class="op">(</span><span class="string">&#x27;wflmovie&#x27;</span><span class="op">,</span><span class="string">&#x27;wfl&#x27;</span><span class="op">,</span>            <span class="name">wplot</span><span class="op">.</span><span class="name">igrey2d</span><span class="op">(</span><span class="string">&#x27;pclip=99.9&#x27;</span><span class="op">,</span><span class="name">par</span><span class="op">)</span><span class="op">)</span>

<span class="name">End</span><span class="op">(</span><span class="op">)</span>
<span class="text"></span></font></pre></table>
     </div>
     </body>
     </html>
     